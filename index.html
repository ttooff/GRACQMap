<!DOCTYPE html>
<html>
<head>
	<title>GRACQ Carte Légence Uniformisée</title>
	<link
		rel="stylesheet"
		href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
		integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
		crossorigin=""
	/>
	<script
		src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
		integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
		crossorigin="">
	</script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js">
	</script>
	
</head>
<body>
 <style>
    body {
      padding: 0;
      margin: 0;
	overflow: hidden;
    }
    html, body {
      height: 100%;
      width: 100%;
    }
	.row {
 	  display: flex;
	  height: 100%;
	}
	.column {
  	  flex: 50%;
	}
	#map {
      height: 100%;
      width: 100%;
    }
	#player {
      height: 50%
      width: 100%;
    }
  </style>
  
<div class="row">
	<div class="column">
		<div id="map"></div>
	</div>
	<div class="column">
		<div id="player"></div>
		<div id="timer"></div>
		<div id="data"></div>
	</div>
</div>

<script>

	var coords = [50.69534117137035, 5.338850682671155]; // the geographic center of our map
	var zoomLevel = 10; // the map scale. See: http://wiki.openstreetmap.org/wiki/Zoom_levels

	var map = L.map('map').setView(coords, zoomLevel);

	L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    	maxZoom: 19,
    	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);

	var gpx = 'GH030798_1_GPS5.gpx';
	var gpxData;
	
	new L.GPX(gpx, {async: true}).on('loaded', function(e) {
  		map.fitBounds(e.target.getBounds());
	}).addTo(map);

	var tag = document.createElement('script');

	tag.src = "https://www.youtube.com/iframe_api";
	var firstScriptTag = document.getElementsByTagName('script')[0];
	firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

	var player;
	function onYouTubeIframeAPIReady() {
		player = new YT.Player('player', {
			height: '50%',
			width: '100%',
			videoId: 'WMQzJ3aAE_M',
			events: {
				'onReady': onPlayerReady,
				'onStateChange': onPlayerStateChange
			}
		});
	}

	function onPlayerReady(event) {
		event.target.playVideo();
	}
	
      var done = false;
      function onPlayerStateChange(event) {
	if (event.data == YT.PlayerState.PLAYING && !done) {
	  setTimeout(stopVideo, 6000);
	  done = true;
	}
      }
      function stopVideo() {
	player.stopVideo();
      }
	
	setInterval(showPlaytime, 55);
	

	 
	// Read the contents of the GPX file
	fetch('GH030798_1_GPS5.gpx')
	  .then(response => response.text())
	  .then(xmlString => {
	    // Parse the XML content of the GPX file
	    const parser = new DOMParser();
	    const xmlDoc = parser.parseFromString(xmlString, 'text/xml');

	    // Extract the time, latitude, and longitude data from the GPX file
	    const trkpts = xmlDoc.getElementsByTagName('trkpt');

		
	for (let i = 0; i < trkpts.length; i++) {
	      const trkpt = trkpts[i];
	      const time = trkpt.getElementsByTagName('time')[0].textContent;
	      const lat = trkpt.getAttribute('lat');
	      const lon = trkpt.getAttribute('lon');
	      const timeSec = new Date(time).getTime()/1000 - startTimeSec;
		    
	      // Do something with the time, latitude, and longitude data
	      console.log(`Time in sec: ${timeSec}, Latitude: ${lat}, Longitude: ${lon}`);
	 }
	});
	
	const trkpt = trkpts[0];
	const startTime = trkpt.getElementsByTagName('time')[0].textContent;
	const startTimeSec = new Date(time).getTime()/1000;
	
	var t;
	var cnt = 0;
	
	function showPlaytime() {
		t = !player.getCurrentTime ? 0.0 : player.getCurrentTime();
		document.getElementById("timer").innerHTML = t.toString();
		
		const trkpt = trkpts[cnt];
		const time = trkpt.getElementsByTagName('time')[0].textContent;
		
	}
	
	
	

</script>
</body>
</html>
